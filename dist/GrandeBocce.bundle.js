!function(){"use strict";var e={d:function(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}e.d(t,{default:function(){return m}});var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a;return t=e,a=[{key:"fetchTemplate",value:function(t,n){var a=this;return new Promise((function(s,r){window.Bocce.clearEvents(),window.Bocce.scene.style.opacity=0,e.dgid("text-header").style.animation="none",setTimeout((function(){fetch(t).then((function(t){t.text().then((function(t){window.Bocce.scene.className=n,window.Bocce.scene.innerHTML="",window.Bocce.scene.appendChild(a.parseTemplate(t)),window.Bocce.scene.style.opacity=1,e.dgid("text-header").style.animation="",setTimeout(s,200)})).catch(r)})).catch(r)}),200)}))}},{key:"parseTemplate",value:function(e){return document.createRange().createContextualFragment(e)}},{key:"secondsToTimecode",value:function(e,t){var n={h:0,m:0,s:0,ms:0};return n.h=Math.floor(e/3600),n.m=Math.floor((e-3600*n.h)/60),n.s=Math.floor(e-3600*n.h-60*n.m),n.ms=Math.floor(100*(e-60*n.m-n.s)),n.h<10&&(n.h="0".concat(n.h)),n.m<10&&(n.m="0".concat(n.m)),n.s<10&&(n.s="0".concat(n.s)),n.ms<10&&(n.ms="0".concat(n.ms)),n.h>0?"".concat(n.h,"h ").concat(n.m,"m ").concat(n.s,"s"):!0===t?"".concat(n.m,"m ").concat(n.s,"s ").concat(n.ms,"ms"):"".concat(n.m,"h ").concat(n.s,"s")}},{key:"dgid",value:function(e){return document.getElementById(e)}}],null&&n(t.prototype,null),a&&n(t,a),e}();function s(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._menes=[],this._teams={A:{score:0,players:[]},B:{score:0,players:[]}},this._startingTeam=0,this._bowlsPerPlayer=0,this._remainingBowls=0,this._meneScoreA=0,this._meneScoreB=0,this._gameStats={menes:null,start:null,end:null,winner:"",scoreA:0,scoreB:0},this._init(t),this.drawstarterView().then((function(){n._gameStats.start=Date.now(),n.newMene()}))}var t,n;return t=e,(n=[{key:"_init",value:function(e){this._startingTeam=Math.floor(10*Math.random())>4?"A":"B",this._bowlsPerPlayer=3===e.A.length?2:3;for(var t=0;t<e.A.length;++t)this._teams.A.players.push({name:e.A[t],team:"A",stats:{boom:0,kiss:0,score:0,miss:0,takenPoints:0}}),this._teams.B.players.push({name:e.B[t],team:"B",stats:{boom:0,kiss:0,score:0,miss:0,takenPoints:0}})}},{key:"endGame",value:function(){var e=this;return new Promise((function(t){a.fetchTemplate("assets/html/game/endgame.html","end-game").then((function(){a.dgid("text-header").innerHTML="Fin de partie",a.dgid("subtext-header").innerHTML="",a.dgid("game-winner").innerHTML="C'est l'équipe ".concat(e._gameStats.winner," qui remporte cette partie."),a.dgid("game-score").innerHTML="Le score final de cette rencontre est de ".concat(e._gameStats.scoreA," à ").concat(e._gameStats.scoreB,"."),a.dgid("game-time").innerHTML="Ce match acharné à pris ".concat(a.secondsToTimecode((e._gameStats.end-e._gameStats.start)/1e3)," pour atteindre son terme."),window.Bocce.evts.addEvent("click",a.dgid("homepage"),window.Bocce.homepageView,window.Bocce),t()})).catch(window.Bocce.fetchPageError)}))}},{key:"drawstarterView",value:function(){var e=this;return new Promise((function(t){a.fetchTemplate("assets/html/game/drawstarter.html","draw-starter").then((function(){a.dgid("text-header").innerHTML="Tirage au sort",setTimeout((function(){return a.dgid("draw-starter").innerHTML="L'équipe ".concat(e._startingTeam)}),1e3),setTimeout((function(){return a.dgid("late1").style.opacity=1}),3500),setTimeout((function(){return a.dgid("late2").style.opacity=1}),5e3),setTimeout(t,6500)})).catch(window.Bocce.fetchPageError)}))}},{key:"newMene",value:function(){var e=this;return new Promise((function(t){a.fetchTemplate("assets/html/game/mene.html","mene").then((function(){a.dgid("text-header").innerHTML="".concat(e._teams.A.score," — ").concat(e._teams.B.score),a.dgid("subtext-header").innerHTML="Mène n°".concat(e._menes.length+1),e._remainingBowls=2*e._teams.A.players.length*e._bowlsPerPlayer,e._meneScoreB=0,e._meneScoreA=0;for(var n=0;n<e._teams.A.players.length;++n)e._addPlayerForMene("A",e._teams.A.players[n]),e._addPlayerForMene("B",e._teams.B.players[n]);var s="A"===e._startingTeam?"B":"A";a.dgid(s).classList.add("disabled"),a.dgid("bowls-remaining-A").innerHTML=e._remainingBowls/2,a.dgid("bowls-remaining-B").innerHTML=e._remainingBowls/2,window.Bocce.evts.addEvent("click",a.dgid("cancel-mene"),e.endMene.bind(e,!0)),t()})).catch(window.Bocce.fetchPageError)}))}},{key:"endMene",value:function(e){var t=this;return new Promise((function(n){a.fetchTemplate("assets/html/game/endmene.html","end-mene").then((function(){a.dgid("subtext-header").innerHTML="",t._meneScoreB=0,t._meneScoreA=0;for(var s=0;s<t._teams.A.players.length;++s)t._addPlayerForEndMene("A",t._teams.A.players[s]),t._addPlayerForEndMene("B",t._teams.B.players[s]);var r={scoreA:0,scoreB:0,meneWinner:"-",teamA:JSON.parse(JSON.stringify(t._teams.A)),teamB:JSON.parse(JSON.stringify(t._teams.B))};e?(a.dgid("text-header").innerHTML="Mène nulle",a.dgid("A").classList.add("disabled"),a.dgid("B").classList.add("disabled"),a.dgid("referee-help").innerHTML="Cette mène est comptabilisée comme nulle. La mène suivante va démarrer.",r.scoreA=t._teams.A.score,r.scoreB=t._teams.B.score,t._menes.push(r),setTimeout(t.newMene.bind(t),5e3)):(a.dgid("text-header").innerHTML="Comptage de points",window.Bocce.evts.addEvent("click",a.dgid("end-mene"),(function(){t._teams.A.score+=t._meneScoreA,t._teams.B.score+=t._meneScoreB,r.scoreA=t._meneScoreA,r.scoreB=t._meneScoreB,r.meneWinner=t._meneScoreA>t._meneScoreB?"A":"B",t._startingTeam=r.meneWinner,t._menes.push(r),t._teams.A.score>=13||t._teams.B.score>=13?(t._gameStats.end=Date.now(),t._gameStats.menes=t._menes,t._gameStats.scoreA=t._teams.A.score,t._gameStats.scoreB=t._teams.B.score,t._gameStats.winner=t._teams.A.score>t._teams.B.score?"A":"B",t.endGame()):t.newMene()}),t)),n()})).catch(window.Bocce.fetchPageError)}))}},{key:"_addPlayerForMene",value:function(e,t){var n=this,s=document.createElement("DIV"),r=document.createElement("P"),i=document.createElement("DIV"),o=document.createElement("DIV"),c=document.createElement("DIV"),l=document.createElement("DIV"),d=document.createElement("IMG"),u=document.createElement("IMG"),m=document.createElement("IMG"),h=document.createElement("IMG");s.classList="player",r.innerHTML=t.name,i.dataset.value=0,o.dataset.value=0,c.dataset.value=0,l.dataset.value=0,d.src="assets/img/boom.svg",u.src="assets/img/kiss.svg",m.src="assets/img/point.svg",h.src="assets/img/miss.svg",s.appendChild(r),i.appendChild(d),o.appendChild(u),c.appendChild(m),l.appendChild(h),s.appendChild(i),s.appendChild(o),s.appendChild(c),s.appendChild(l),window.Bocce.evts.addEvent("click",d,(function(){i.dataset.value=parseInt(i.dataset.value)+1,t.stats.boom+=1}),d),window.Bocce.evts.addEvent("click",m,(function(){if(c.dataset.value=parseInt(c.dataset.value)+1,t.stats.score+=1,"A"===t.team&&n._meneScoreA<n._meneScoreB)n._meneScoreB=0,n._meneScoreA=1,a.dgid("A").classList.add("disabled"),a.dgid("B").classList.remove("disabled");else if("B"===t.team&&n._meneScoreB<n._meneScoreA)n._meneScoreB=1,n._meneScoreA=0,a.dgid("A").classList.remove("disabled"),a.dgid("B").classList.add("disabled");else{var e="A"===t.team?"B":"A",r=parseInt(a.dgid("bowls-remaining-".concat(e)).innerHTML);n["_meneScore".concat(t.team)]+=1,r>0&&(a.dgid(t.team).classList.add("disabled"),a.dgid(e).classList.remove("disabled"))}var i=parseInt(a.dgid("bowls-remaining-".concat(t.team)).innerHTML)-1;a.dgid("bowls-remaining-".concat(t.team)).innerHTML=i,parseInt(c.dataset.value)+parseInt(l.dataset.value)===n._bowlsPerPlayer&&s.classList.add("disabled"),--n._remainingBowls,0===n._remainingBowls&&n.endMene()}),m),window.Bocce.evts.addEvent("click",u,(function(){o.dataset.value=parseInt(o.dataset.value)+1,t.stats.kiss+=1}),u),window.Bocce.evts.addEvent("click",h,(function(){var e="A"===t.team?"B":"A";l.dataset.value=parseInt(l.dataset.value)+1,t.stats.miss+=1;var r=parseInt(a.dgid("bowls-remaining-".concat(t.team)).innerHTML)-1;a.dgid("bowls-remaining-".concat(t.team)).innerHTML=r,0===r&&(a.dgid(t.team).classList.add("disabled"),a.dgid(e).classList.remove("disabled")),parseInt(c.dataset.value)+parseInt(l.dataset.value)===n._bowlsPerPlayer&&s.classList.add("disabled"),--n._remainingBowls,0===n._remainingBowls&&n.endMene()}),h),a.dgid(e).appendChild(s)}},{key:"_addPlayerForEndMene",value:function(e,t){var n=this,s=document.createElement("DIV"),r=document.createElement("P"),i=document.createElement("DIV"),o=document.createElement("IMG");s.classList="player",r.innerHTML=t.name,i.dataset.value=0,o.src="assets/img/score.svg",s.appendChild(r),i.appendChild(o),s.appendChild(i),window.Bocce.evts.addEvent("click",o,(function(){var e="A"===t.team?"B":"A";parseInt(i.dataset.value)+1<=n._bowlsPerPlayer?(i.dataset.value=parseInt(i.dataset.value)+1,t.stats.takenPoints+=1,n["_meneScore".concat(t.team)]+=1,a.dgid(e).classList.add("disabled"),t.stats.takenPoints===n._bowlsPerPlayer&&s.classList.add("disabled")):s.classList.add("disabled")}),o),a.dgid(e).appendChild(s)}}])&&s(t.prototype,n),e}();function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o(this,e),"boolean"!=typeof t&&(t=!1),this._debug=t,this._idIncrementor=5678*Math.floor(Math.random()*Math.floor(256)),this._regularEvents=[],this._customEvents={},this.version="1.2.1"}var t,n;return t=e,(n=[{key:"destroy",value:function(){var e=this;this._raise("log","CustomEvents.destroy"),this.removeAllEvents(),Object.keys(this).forEach((function(t){delete e[t]}))}},{key:"addEvent",value:function(e,t,n){var a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this._raise("log","CustomEvents.addEvent: ".concat(e," ").concat(t," ").concat(n," ").concat(s," ").concat(r)),null==e||null==t||null==n)return this._raise("error","CustomEvents.addEvent: Missing mandatory arguments"),!1;var o=function(){a._raise("error","CustomEvents.addEvent: Wrong type for argument")};return"string"!=typeof e||"object"!==i(t)||"function"!=typeof n||null!=s&&"object"!==i(s)||null!=r&&"object"!==i(r)&&"boolean"!=typeof r?(o(),!1):(n=n.bind(s),this._regularEvents.push({id:this._idIncrementor,element:t,eventName:e,scope:s,callback:n,options:r}),t.addEventListener(e,n,r),this._idIncrementor++)}},{key:"removeEvent",value:function(e){if(this._raise("log","Events.removeEvent: ".concat(e)),null==e)return this._raise("error","CustomEvents.removeEvent: Missing mandatory arguments"),!1;if("number"!=typeof e)return this._raise("error","CustomEvents.removeEvent: Wrong type for argument"),!1;for(var t=!1,n=this._regularEvents.length-1;n>=0;--n)this._regularEvents[n].id===e&&(t=!0,this._clearRegularEvent(n));return t}},{key:"removeAllEvents",value:function(){this._raise("log","CustomEvents.removeAllEvents");for(var e=!1,t=this._regularEvents.length>0,n=this._regularEvents.length-1;n>=0;--n)this._clearRegularEvent(n);return 0===this._regularEvents.length&&t&&(e=!0),e}},{key:"_clearRegularEvent",value:function(e){if(this._raise("log","CustomEvents._clearRegularEvent: ".concat(e)),null==e)return this._raise("error","CustomEvents._clearRegularEvent: Missing mandatory argument"),!1;if("number"!=typeof e)return this._raise("error","CustomEvents._clearRegularEvent: Wrong type for argument"),!1;if(this._regularEvents[e]){var t=this._regularEvents[e];return t.element.removeEventListener(t.eventName,t.callback,t.options),this._regularEvents.splice(e,1),!0}return!1}},{key:"subscribe",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._raise("log","CustomEvents.subscribe: ".concat(e," ").concat(t," ").concat(a)),null==e||null==t)return this._raise("error","CustomEvents.subscribe","Missing mandatory arguments"),!1;var s=function(){n._raise("error","CustomEvents.subscribe: Wrong type for argument")};return"string"!=typeof e||"function"!=typeof t||null!=a&&"boolean"!=typeof a?(s(),!1):(this._customEvents[e]||(this._customEvents[e]=[]),this._customEvents[e].push({id:this._idIncrementor,name:e,os:a,callback:t}),this._idIncrementor++)}},{key:"unsubscribe",value:function(e){if(this._raise("log","CustomEvents.unsubscribe: ".concat(e)),null==e)return this._raise("error","CustomEvents.unsubscribe: Missing mandatory arguments"),!1;if("number"!=typeof e)return this._raise("error","CustomEvents.unsubscribe: Wrong type for argument"),!1;for(var t=!1,n=Object.keys(this._customEvents),a=n.length-1;a>=0;--a)for(var s=this._customEvents[n[a]],r=0;r<s.length;++r)if(s[r].id===e){this._raise("log","CustomEvents.unsubscribe: subscription found\n",s[r],"\nSubscription n°".concat(e," for ").concat(s.name," has been removed")),t=!0,s.splice(r,1),0===s.length&&delete this._customEvents[n[a]];break}return t}},{key:"unsubscribeAllFor",value:function(e){if(this._raise("log","CustomEvents.unsubscribeAllFor: ".concat(e)),null==e)return this._raise("error","CustomEvents.unsubscribeAllFor: Missing mandatory arguments"),!1;if("string"!=typeof e)return this._raise("error","CustomEvents.unsubscribeAllFor: Wrong type for argument"),!1;for(var t=!1,n=Object.keys(this._customEvents),a=0;a<n.length;++a)if(n[a]===e)for(var s=this._customEvents[n[a]],r=s.length-1;r>=0;--r)t=!0,s.splice(r,1),0===s.length&&delete this._customEvents[n[a]];return t}},{key:"publish",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._raise("log","CustomEvents.publish: ".concat(e," ").concat(t)),null==e)return this._raise("error","CustomEvents.publish: Missing mandatory arguments"),!1;if("string"!=typeof e||void 0!==t&&"object"!==i(t))return this._raise("error","CustomEvents.publish: Wrong type for argument"),!1;for(var n=!1,a=Object.keys(this._customEvents),s=0;s<a.length;++s)if(a[s]===e){n=!0;for(var r=this._customEvents[a[s]],o=r.length-1;o>=0;--o)this._raise("log","CustomEvents.publish: fire callback for ".concat(e,", subscription n°").concat(r[o].id),r[o]),r[o].callback(t),r[o].os&&(this._raise("log","CustomEvents.publish: remove subscription because one shot usage is done"),r.splice(o,1),0===r.length&&delete this._customEvents[a[s]])}return n}},{key:"_raise",value:function(e,t){this._debug&&console[e](t)}}])&&c(t.prototype,n),e}();function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=null,this.evts=null,this._game=null}var t,n;return t=e,(n=[{key:"init",value:function(){this.scene=document.getElementById("app-container"),this.evts=new l,this.homepageView()}},{key:"homepageView",value:function(){var e=this;return new Promise((function(t){a.fetchTemplate("assets/html/homepageview.html","home").then((function(){a.dgid("text-header").innerHTML="GrandeBocce",e.evts.addEvent("click",a.dgid("new-game"),e.teamspageView,e),e.evts.addEvent("click",a.dgid("rules"),e.rulespageView,e),t()})).catch(e.fetchPageError)}))}},{key:"teamspageView",value:function(){var e=this;return new Promise((function(t){a.fetchTemplate("assets/html/teamspageview.html","teams").then((function(){a.dgid("text-header").innerHTML="Équipes",e.evts.addEvent("click",a.dgid("1"),e.playerspageView,e),e.evts.addEvent("click",a.dgid("2"),e.playerspageView,e),e.evts.addEvent("click",a.dgid("3"),e.playerspageView,e),e.evts.addEvent("click",a.dgid("homepage"),e.homepageView,e),t()})).catch(e.fetchPageError)}))}},{key:"playerspageView",value:function(e){var t=this;return new Promise((function(n){a.fetchTemplate("assets/html/playerspageview.html","players").then((function(){a.dgid("text-header").innerHTML="Joueurs",t.evts.addEvent("click",a.dgid("homepage"),t.homepageView,t),t._fillPlayerspageView(parseInt(e.target.id)||parseInt(e.target.parentNode.id)),n()})).catch(t.fetchPageError)}))}},{key:"rulespageView",value:function(){var e=this;return new Promise((function(t){a.fetchTemplate("assets/html/rulespageview.html","rules").then((function(){a.dgid("text-header").innerHTML="Règles du jeu",e.evts.addEvent("click",a.dgid("homepage"),e.homepageView,e),t()})).catch(e.fetchPageError)}))}},{key:"searchplayerModal",value:function(){}},{key:"fetchPageError",value:function(e){console.error("GrandeBocce : Unable to fetch HTML template.",e)}},{key:"clearEvents",value:function(){this.evts.removeAllEvents()}},{key:"_fillPlayerspageView",value:function(e){var t=this,n=[],s=function(s){for(var r=0;r<e;++r){var i=document.createElement("DIV"),o=document.createElement("P"),c=document.createElement("INPUT"),l=document.createElement("IMG");i.classList.add("player"),o.innerHTML="n°".concat(r+1),c.dataset.team=s,l.src="assets/img/search.svg",i.appendChild(o),i.appendChild(c),i.appendChild(l),a.dgid(s).appendChild(i),n.push(c),t.evts.addEvent("click",l,t.searchplayerModal,t)}};s("A"),s("B"),this.evts.addEvent("click",a.dgid("startx"),(function(){for(var e={A:[],B:[]},s=!1,i=0;i<n.length;++i)""===n[i].value?(n[i].classList.add("error"),s=!0,a.dgid("subtext-header").innerHTML="Il manque des noms de joueurs"):e[n[i].dataset.team].push(n[i].value);s||(a.dgid("subtext-header").innerHTML="",t._game=new r(e))}),this)}}])&&d(t.prototype,n),e}();window.Bocce=new u,window.Bocce.init();var m=u;window.GrandeBocce=t.default}();